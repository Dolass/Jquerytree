var zWizContentSelector="body",zWizEditorCallback={callback:{getDomImg:function(){window.WizNote.onEditorClickImage()},getDomTxt:function(f){window.WizNote.onEditorClickText(f)}}};
(function(f){var b={WIZTAG:"wiz",WIZTAG_RegExp:/<wiz>|<\/wiz>/ig,IMG_BORDER:"solid yellow",_isEditing:!1,_main:null,_curObj:null,initHtml:function(){var a=b._main;if(a&&a.get(0)){var d=a.find("a"),c,e,g;for(c=0,e=d.length;c<e;c++)g=d[c],b.initAnchor(g);a=a.find("span");for(c=0,e=a.length;c<e;c++)d=a[c],b.initSpan(d)}},recoverHtml:function(){var a=b._main;if(a&&a.get(0)){var a=a.find(b.WIZTAG),d,c;for(d=0,c=a.length;d<c;d++)b.recoverWiz(a[d])}},getHTML:function(){return b._main.html().replace(b.WIZTAG_RegExp,
"")},initAnchor:function(a){if(a){var d,c,a=a.childNodes;for(d=0,c=a.length;d<c;d++)b._TextNodeToWiz(a[d])}},initSpan:function(a){if(a&&!(a.childNodes.length==1||a.children.length==a.childNodes.length)){var d,c,a=a.childNodes;for(d=0,c=a.length;d<c;d++)b._TextNodeToWiz(a[d])}},_TextNodeToWiz:function(a){if(a.nodeType==3){var d,c,e;d=a.parentNode;c=a.nextSibling;e=document.createElement(b.WIZTAG);e.appendChild(a);d.insertBefore(e,c)}},recoverWiz:function(a){a&&(a.parentNode.insertBefore(a.childNodes[0],
a.nextSibling),a.parentNode.removeChild(a))},updateText:function(a){if(b._isEditing&&b._curObj)b._curObj.nodeType==3?b._curObj.textContent=a:b._curObj.innerText=a,b.resetEdit()},updateImg:function(a){if(b._isEditing&&b._curObj)a.src?b._curObj.src=a.src:b._curObj.parentNode.removeChild(b._curObj),b.resetEdit()},resetEdit:function(){b._isEditing=!0;if(b._curObj&&b._curObj.tagName&&b._curObj.tagName.toLowerCase()=="img")b._curObj.style.border="";b._curObj=null},handler:{onClick:function(a){var d=window.getSelection().baseNode,
c=a.target,e=c.childNodes,g=!1,f,h;b._curObj&&b.resetEdit();if(c.tagName.toLowerCase()=="img")c.style.border=b.IMG_BORDER,b._curObj=c,a.data.callback.apply(this,[c]);else{for(f=0,h=e.length;f<h;f++)if(e[f]==d){g=!0;break}e="";if(g)b._curObj=d,e=d.textContent;else if(c.children.length==0)b._curObj=c,e=c.innerText;e.length>0?a.data.callback.apply(this,[e]):b._curObj=null}a.preventDefault&&a.preventDefault();if(a.bubbles)a.bubbles=!1}}};f.fn.wizEditorStart=function(a){if(this.get(0)&&!b._isEditing)b.resetEdit(),
b._main=this,b.initHtml(),this.bind("click",{callback:function(b){typeof b=="string"?a.callback.getDomTxt.apply(this,[b]):a.callback.getDomImg.apply(this,[b.src])}},b.handler.onClick)};f.fn.wizEditorStop=function(){if(this.get(0))b._isEditing=!1,b._curObj=null,b.recoverHtml(),b._main=null,this.unbind("click",b.handler.onClick)};window.zWizEditorGetHtml=function(){return b.getHTML()};window.zWizEditorUpdateHtml=function(a){b.updateText(a)};window.zWizEditorUpdateImg=function(a){b.updateImg(a)};window.zWizEditorReset=
function(){b.resetEdit()}})(jQuery);$(zWizContentSelector).wizEditorStart(zWizEditorCallback);
