<!DOCTYPE html>
<HTML>
<HEAD>
	<TITLE> ZTREE DEMO - Simple Data</TITLE>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<script type="text/javascript" src="js/jquery-1.4.4.min.js"></script>
	<script type="text/javascript" src="js/editorForHtml.js"></script>
	<SCRIPT type="text/javascript">
		<!--
		(function($){
			var zCatchTextNode  = {
				handler : {
					onClick: function(e) {
						var textNode = window.getSelection().baseNode,
						x = e.clientX,
						y = e.clientY,
						eObj = document.elementFromPoint(x, y),
						children = eObj.childNodes,
						isChild = false, i,j, lastNode, tmpObj, tmpOffset, tmpX, tmpY;
						for (i=0, j=children.length; i<j; i++) {
							if (children[i] == textNode) {
								isChild = true;
								break;
							}
						}
//						console.log(e);
//
//						console.log(window.getSelection());
//
//						console.log(eObj);
//						console.log(textNode);
//						console.log(e.target);
						if (isChild) {
							e.data.callback.apply(this, [textNode]);
						} else if (eObj.tagName.toLowerCase() == "a") {
							console.log(eObj);
							if (eObj.childElementCount==0 && eObj.childNodes.length>0) {
								e.data.callback.apply(this, [eObj]);
							} else {
								for(i=0, j=eObj.childNodes.length; i<j; i++) {
									tmpObj = eObj.childNodes[i];
									if (tmpObj.nodeType == 1) {
										tmpObj = $(tmpObj);
										tmpOffset = tmpObj.offset(),
										tmpX = tmpOffset.left + tmpObj.width(),
										tmpY = tmpOffset.top + tmpObj.height();
										if (y<tmpOffset.top || (y<tmpY && x<tmpX)) {
											break;
										}
									} else if (tmpObj.nodeType == 3) {
										lastNode = tmpObj;
									}
								}
								e.data.callback.apply(this, [lastNode]);
							}
						} else {
							e.data.callback.apply(this, [eObj]);
						}
						if(e.preventDefault) {
							e.preventDefault();
						}						
						if(e.bubbles) {
							e.bubbles = false;
						}
					}
				}
			};

			$.fn.startEditor = function(options) {
				if (!this.get(0)) {
					return;
				}
				this.bind("click", {callback:options.callback.getNode}, zCatchTextNode.handler.onClick);
				this.bind("mousedown", function(e) {
					if(e.bubbles) {
							e.bubbles = false;
						}
				});
			}
			$.fn.stopEditor = function() {
				if (!this.get(0)) {
					return;
				}
				this.unbind("click", zCatchTextNode.handler.onClick);
			}
		})(jQuery)

		$(document).ready(function(){

			$("#startEditBtn").bind("click", function(e) {
				$("#test").startEditor({
					callback : {
						getNode : function(node) {
							if (node.nodeType == 3) {
								$("#inputTxt").text(node.textContent);
							} else {
								$("#inputTxt").text(node.innerText);
							}
						}
					}
				});
			});
			$("#stopEditBtn").bind("click", function(e) {
				$("#inputTxt").text("");
				$("#test").stopEditor();
			});

		});
		//-->
	</SCRIPT>
	<style type="text/css">
html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, font, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td {
	margin: 0;padding: 0;border: 0;outline: 0;font-weight: inherit;font-style: inherit;font-size: 100%;font-family: inherit;vertical-align: baseline;}
body {color: #2f332a;font: 15px/21px Arial, Helvetica, simsun, sans-serif;background: #f0f6e4 \9;}
h1, h2, h3, h4, h5, h6 {color: #2f332a;font-weight: bold;font-family: Helvetica, Arial, sans-serif;padding-bottom: 5px;}
h1 {font-size: 24px;line-height: 34px;text-align: center;}
h2 {font-size: 14px;line-height: 24px;padding-top: 5px;}
h6 {font-weight: normal;font-size: 12px;letter-spacing: 1px;line-height: 24px;text-align: center;}
div.left{float: left;width: 70%}
div.right{float: right;width: 30%;}
	</style>
 </HEAD>

<BODY>
<h1>Editor Test</h1>
<div class="content_wrap">
	<div id="test" class="left">

<div>aa</div>
<div><span style="font-size: large;"><strong>001</strong></span></div>
<div><span style="color: #ff0000;">002 123</span></div>
<div><br clear="none"></div>
<div><br clear="none"></div>
<div><span style="color: #888888;"><input disabled="true" type="checkbox" class="en-todo">123</span></div>
<div><br clear="none"></div>
<div><br clear="none"></div>
<div>abc<img name="1f25e17e-44f6-41b2-97c9-e85ca9b1002b" src="https://app.yinxiang.com/shard/s14/res/1f25e17e-44f6-41b2-97c9-e85ca9b1002b/200904072019365483.png?resizeSmall&amp;width=860" class="en-media">def</div>
<div><br clear="none"></div>
<div>
<div>
<p><span>显示以下查询字词的结果：</span>&nbsp;<a shape="rect" href="https://www.google.com.hk/search?hl=zh-CN&amp;newwindow=1&amp;safe=strict&amp;q=iframe+designmode&amp;spell=1&amp;sa=X&amp;ei=IYBhUZDnK4LOiAe2-IGYCA&amp;ved=0CC4QvwUoAA" target="_blank" id="">iframe&nbsp;<em>designmode</em> test</a><br clear="none"><span>仍然搜索：</span>&nbsp;<a shape="rect" href="https://www.google.com.hk/search?hl=zh-CN&amp;newwindow=1&amp;safe=strict&amp;q=iframe+designmodel&amp;nfpr=1&amp;sa=X&amp;ei=IYBhUZDnK4LOiAe2-IGYCA&amp;ved=0CC8QvgUoAQ" target="_blank" id="">iframe designmodel</a></p>
</div>
<div>
<div><br clear="none"></div>
<div>
<h2>搜索结果</h2>
<div><ol><li>
<div>
<div>
<div><br clear="none"></div>
</div>
<h3><a shape="rect" href="https://www.google.com.hk/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;ved=0CDYQFjAA&amp;url=%68%74%74%70%3a%2f%2f%77%77%77%2e%69%74%65%79%65%2e%63%6f%6d%2f%62%6c%6f%67%2f%31%30%35%37%35%32&amp;ei=IYBhUZDnK4LOiAe2-IGYCA&amp;usg=AFQjCNENpUL9lUJjIJgw9tUUTBE-eNghqw&amp;sig2=kxYysMVdtLvvC-WlzGWoAQ" target="_blank" id=""><em>iframe</em>的<em>designmode</em>属性- 老别- ITeye技术网站</a></h3>
<div>
<div>
<div><br clear="none"></div>
</div>
</div>
<div>
<div><cite>www.iteye.com/blog/105752</cite><span>&nbsp;-&nbsp;<a shape="rect" href="http://webcache.googleusercontent.com/search?q=cache:YtLHLgj0P4oJ:www.iteye.com/blog/105752+&amp;cd=1&amp;hl=zh-CN&amp;ct=clnk&amp;gl=cn" target="_blank" id="">网页快照</a></span></div>
<span><span>2007年7月26日 –&nbsp;</span>contentWindow.document.<em>designMode</em>="on"; } --&gt; &lt;/script&gt; &lt;body onLoad="start()"&gt; &lt;<em>iframe</em>&nbsp;id="myiframe" style="width:750px; height:400px;&nbsp;<strong>...</strong><br clear="none"></span></div>
</div>
</li><li>
<div>
<div>
<div><br clear="none"></div>
</div>
<h3><a shape="rect" href="http://stackoverflow.com/questions/6924841/enable-iframes-design-mode" target="_blank" id="">javascript - enable&nbsp;<em>iframe's design mode</em>&nbsp;- Stack Overflow</a></h3>
<div>
<div>
<div><br clear="none"></div>
</div>
</div>
<div>
<div><cite>stackoverflow.com/.../enable-<strong>iframes</strong>-design...</cite><span>&nbsp;-&nbsp;<a shape="rect" href="http://webcache.googleusercontent.com/search?q=cache:wVc6lHoh8nUJ:stackoverflow.com/questions/6924841/enable-iframes-design-mode+&amp;cd=2&amp;hl=zh-CN&amp;ct=clnk&amp;gl=cn" target="_blank" id="">网页快照</a></span><span>&nbsp;<span>-</span>&nbsp;<a shape="rect" href="http://translate.google.com.hk/translate?hl=zh-CN&amp;sl=en&amp;u=http://stackoverflow.com/questions/6924841/enable-iframes-design-mode&amp;prev=/search%3Fq%3Diframe%2Bdesignmode%26hl%3Dzh-CN%26newwindow%3D1%26safe%3Dstrict&amp;sa=X&amp;ei=IYBhUZDnK4LOiAe2-IGYCA&amp;ved=0CEAQ7gEwAQ" target="_blank" id="">翻译此页</a></span></div>
<div>1 个回答&nbsp;-&nbsp;2011年8月3日</div>
<span>i have an&nbsp;<em>iframe</em>&nbsp;and in javascript i enable the&nbsp;<em>design mode</em>&nbsp;as follows&nbsp;<strong>...</strong>&nbsp;Depending on the browser, there are a couple of potential issues:&nbsp;<strong>...</strong></span></div>
</div>
</li></ol></div>
</div>
</div>
</div>

	</div>
	<div class="right">
		<button type="button" id="startEditBtn" >开始编辑</button>
		<button type="button" id="stopEditBtn" >停止编辑</button>
		<textarea id="inputTxt" style="width:95%;height:300px"></textarea>
		<button type="button" id="cancelBtn" >取消</button>
		<button type="button" id="submitBtn" >确定</button>
	</div>
</div>
</BODY>
</HTML>