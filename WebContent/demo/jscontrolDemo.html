<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
 <HEAD>
  <TITLE> ZTREE DEMO </TITLE>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" href="demoStyle/demo.css" type="text/css">
  <link rel="stylesheet" href="zTreeStyle/zTreeStyle.css" type="text/css">
  <script type="text/javascript" src="jquery-1.4.2.js"></script>
  <script type="text/javascript" src="jquery-ztree-2.3.js"></script>
  <script type="text/javascript" src="demo.js"></script>
  <SCRIPT LANGUAGE="JavaScript">
  <!--
	var zTree1;
	var setting;

	setting = {
		checkable : true,
		callback: {
			beforeClick: zTreeBeforeClick,
			click:	zTreeOnClick,
			change: zTreeOnChange
		}
	};

	$(document).ready(function(){
		reloadTree();
	});

	var srcNode = null;
	function zTreeOnClick(event, treeId, treeNode) {
		var p = "[" + treeNode.name + "]";
		var pNode = treeNode.parentNode;
		while (pNode != null) {
			p = "[" + pNode.name + "] -- " + p;
			pNode = pNode.parentNode;
		}
		p = "[Root] -- " + p;
		$("#curNodePath").html(p);
		$("#renameTxt").attr("value", treeNode.name);
		$("#jCopy").attr("class","able");
		$("#jxCopy").attr("class","able");
		srcNode = treeNode;
	}
	function zTreeBeforeClick(treeId, treeNode) {
		var canClick = (treeNode!=zTree1.getSelectedNode());
		if (!canClick) {
			zTree1.cancelSelectedNode();
			$("#renameTxt").attr("value", "");
			srcNode = null;
			$("#curNodePath").html("[Root]");
			$("#jCopy").attr("class","disabled");
			$("#jxCopy").attr("class","disabled");
		}
		return canClick;
	}
	
	function zTreeOnChange(event, treeId, treeNode) {
		getNodes();
	}
	
	function expandAll(expandSign) {
		zTree1.expandAll(expandSign);
	}

	function expandNode(expandSign) {
		if (srcNode) {
			zTree1.expandNode(srcNode, expandSign, $("#sonChk").attr("checked"));
		}
	}

	var addCount = 1;
	function addNode(type) {
		var newNode = [{ name:"增加" + (addCount++)}];
		if (type=="p") newNode[0].isParent = true;
		zTree1.addNodes(srcNode, newNode);
		getNodes();
	}
	function removeTreeNode() {
		if (srcNode) {
			if (srcNode.nodes && srcNode.nodes.length > 0) {
				var msg = "要删除的节点是父节点，如果删除将连同子节点一起删掉。\n\n请确认！";
				if (confirm(msg)==true){
					zTree1.removeNode(srcNode);
				}
			} else {
				zTree1.removeNode(srcNode);
			}
		}	
		getNodes();
	}

	function getPreTreeNode(treeNode) {
		if (treeNode.isFirstNode) return null;
		var nodes = treeNode.parentNode ? treeNode.parentNode.nodes : zTree1.getNodes();
		var preNode;
		for (var i=0; i<nodes.length; i++) {
			if (nodes[i] == treeNode) {
				return preNode;
			}
			preNode = nodes[i];
		}
	}
	function getNextTreeNode(treeNode) {
		if (treeNode.isLastNode) return null;
		var nodes = treeNode.parentNode ? treeNode.parentNode.nodes : zTree1.getNodes();
		for (var i=0; i<nodes.length; i++) {
			if (nodes[i] == treeNode) {
				return nodes[i+1];
			}
		}
	}
	
	function moveTreeNode(move) {
		if (!srcNode) {
			alert("请先选中一个节点");
			return;
		}
		var moveType = "inner";
		var targetNode = "";
		if (move == "up") {
			moveType = "before";
			targetNode = getPreTreeNode(srcNode);
		} else if (move == "down") {
			moveType = "after";
			targetNode = getNextTreeNode(srcNode);
		} else if (move == "left") {
			moveType = "after";
			targetNode = srcNode.parentNode;
		} else if (move == "right") {
			moveType = "inner";
			targetNode = getPreTreeNode(srcNode);
		}
		if (srcNode && targetNode) {
			zTree1.moveNode(targetNode, srcNode, moveType);
		}	
		getNodes();
		zTree1.selectNode(srcNode);
	}

	function getNodes() {
		var a = zTree1.transformToArray(zTree1.getNodes());
		$("#allNum").html(a.length);
		a = zTree1.getCheckedNodes();
		$("#allCheckNum").html(a.length);
		
	}

	function makeListName(node) {
		var space = "";
		for (var s = 0; s<node.level; s++ ) {
			space = space + "--";
		}
		return space + node.name + "(" + node.tId + ")";
	}

	function mouseOverLi(obj) {
		var jObj = $(obj);
		if (!jObj.hasClass("selectLi")) {
			jObj.addClass("selectLi_tmp");
		}
	}
	function mouseOutLi(obj) {
		var jObj = $(obj);
		if (!jObj.hasClass("selectLi")) {
			jObj.removeClass();
		}
	}

	function renameTreeNode(txtObj) {
		if (!srcNode) {
			alert("请先选中一个节点");
			$("#renameTxt").attr("value", "");
			return;
		}
		srcNode.name = txtObj.value;
		zTree1.updateNode(srcNode);
		zTree1.selectNode(srcNode);
		
	}
	function checkTreeNode(checked) {
		if (!srcNode) {
			alert("请先选中一个节点");
			return;
		}
		var connFlag = $("#connTrue").attr("checked");
		srcNode.checked = checked;
		zTree1.updateNode(srcNode, connFlag);
	}
	function checkAllTreeNode(checked) {
		zTree1.checkAllNodes(checked);
	}

	function getNodeByParam() {
		var key = $("#searchKey").get(0).value;
		if (key.length > 0) {
			treeNode = zTree1.getNodeByParam("name", key);
			if (treeNode) {
				alert("找到节点信息: \ntId=" + treeNode.tId + ", name=" + treeNode.name + ", level=" + treeNode.level);
			} else {
				alert("没有找到匹配的节点，请更换搜索条件");
			}
		}
	}
	
	function getNodesByParam() {
		var key = $("#searchKey2").get(0).value;
		if (key.length == 0 || isNaN(key)) {
			alert('请输入数字！')
			return; 
		}
		key = parseInt(key);
		treeNodes = zTree1.getNodesByParam("level", key);
		if (treeNodes && treeNodes.length>0) {
			var msg = "找到节点信息: ";
			for (var i=0; i<treeNodes.length; i++) {
				msg += ("\n(" + (i+1) + ") tId=" + treeNodes[i].tId + ", name=" + treeNodes[i].name + ", level=" + treeNodes[i].level); 
			}
			alert(msg);
		} else {
			alert("没有找到匹配的节点，请更换搜索条件");
		}
	}

	function reloadTree() {
		zTree1 = $("#treeDemo").zTree(setting, clone(zNodes));
		$("#renameTxt").attr("value", "");
		$("#curNodePath").html("[Root]");
		getNodes();
		
	}	

	function clone(jsonObj) {
	    var buf;
	    if (jsonObj instanceof Array) {
	        buf = [];
	        var i = jsonObj.length;
	        while (i--) {
	            buf[i] = clone(jsonObj[i]);
	        }
	        return buf;
	    }else if (typeof jsonObj == "function"){
	        return jsonObj;
	    }else if (jsonObj instanceof Object){
	        buf = {};
	        for (var k in jsonObj) {
	            buf[k] = clone(jsonObj[k]);
	        }
	        return buf;
	    }else{
	        return jsonObj;
	    }
	} 

  //-->
  </SCRIPT>
 </HEAD>

<BODY>
<center class="headTitle">Javascript 操作演示</center>
<TABLE border=0 width="700" class="tb1">
	<TR>
		<TD width=340px align=center valign=top>
		<div class="zTreeDemoBackground">
			<ul id="treeDemo" class="tree"></ul>
		</div>		
		</TD>
		<TD width=360px align=left valign=top>
		<div class="demoContent">
			<li class="title focus">
				<button class="ico star" onfocus="this.blur();"></button>获取数据
				<ul class="remark">1、总节点数：<span id="allNum"></span>; 总Check节点数：<span id="allCheckNum"></span></ul>
				<ul class="remark" style="white-space: normal;">2、当前选中节点</ul>
				<ul class="event"><li><span id="curNodePath"></span></li></ul>
			</li>
			<li class="title focus">
				<button class="ico star" onfocus="this.blur();"></button>操作指示
				<ul class="operate">
					[<a id="jCopy" class="disabled">复制</a>] [<a id="jxCopy" class="disabled">剪切</a>] [<a id="jPaste">粘贴</a>]
				</ul>
				<ul class="operate">
					修改节点名称: <input type="text" value="" id="renameTxt" onchange="renameTreeNode(this);"></input></button>
				</ul>
				<ul class="operate">
					增加父节点: <button class="ico addNode" onfocus="this.blur();" title="增加父节点" onclick="addNode('p');"></button>
					增加普通节点: <button class="ico addNode" onfocus="this.blur();" title="增加普通节点" onclick="addNode();"></button>
					删除节点: <button class="ico removeNode" onfocus="this.blur();" title="删除节点" onclick="removeTreeNode();"></button>
				</ul>
				<ul class="operate">
					修改选中节点Check状态：<button class="ico checkNode" onfocus="this.blur();" title="Check节点" onclick="checkTreeNode(true);"></button>
					<button class="ico unCheckNode" onfocus="this.blur();" title="unCheck节点" onclick="checkTreeNode(false);"></button>
					<br/>父子关联：<INPUT TYPE="radio" id="connTrue" name="connRadio" onfocus="this.blur();">true;&nbsp;
					<INPUT TYPE="radio" id="connFalse" name="connRadio" checked onfocus="this.blur();">false
				</ul>
				<ul class="operate">
					修改全部节点Check状态：<button class="ico checkNode" onfocus="this.blur();" title="Check全部节点" onclick="checkAllTreeNode(true);"></button>
					<button class="ico unCheckNode" onfocus="this.blur();" title="unCheck全部节点" onclick="checkAllTreeNode(false);"></button>
				</ul>
				<ul class="operate">
					移动选中节点: 
					<button class="ico up" onfocus="this.blur();" title="同级向上移动" onclick="moveTreeNode('up');"></button>
					<button class="ico down" onfocus="this.blur();" title="同级向下移动" onclick="moveTreeNode('down');"></button>
					<button class="ico left" onfocus="this.blur();" title="成为父节点同级节点" onclick="moveTreeNode('left');"></button>
					<button class="ico right" onfocus="this.blur();" title="成为前一个节点的子节点" onclick="moveTreeNode('right');"></button>
				</ul>
				<ul class="operate">
					选中节点:&nbsp;展开<button class="ico expandNode" onfocus="this.blur();" title="展开选中节点" onclick="expandNode(true);"></button>
					折叠<button class="ico collapseNode" onfocus="this.blur();" title="折叠选中节点" onclick="expandNode(false);"></button>
					&nbsp;<input type="checkbox" id="sonChk" /> 是否包含子节点
				</ul>
				<ul class="operate">
					全部节点:&nbsp;展开<button class="ico expandNode" onfocus="this.blur();" title="全部展开" onclick="expandAll(true);"></button>
					折叠<button class="ico collapseNode" onfocus="this.blur();" title="全部折叠" onclick="expandAll(false);"></button> 
				</ul>
				<ul class="operate">
					名称匹配搜索单个节点: <input type="text" value="手机" id="searchKey"></input>
					<button class="ico searchNode" onfocus="this.blur();" title="搜索" onclick="getNodeByParam();"></button>
					<br />getNodeByParam 方法演示（需要完全匹配）
				</ul>
				<ul class="operate">
					level搜索节点集合: <input type="text" value="0" id="searchKey2"></input>
					<button class="ico searchNode" onfocus="this.blur();" title="搜索" onclick="getNodesByParam();"></button>
					<br />getNodesByParam 方法演示（需要完全匹配）
				</ul>
			</li>
			
		</div>	
		</TD>
	</TR>
</TABLE>
</BODY>
</HTML>
