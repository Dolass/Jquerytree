<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
 <HEAD>
  <TITLE> ZTREE DEMO </TITLE>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" href="demoStyle/demo.css" type="text/css">
  <link rel="stylesheet" href="zTreeStyle/zTreeStyle.css" type="text/css">
  <script type="text/javascript" src="jquery-1.4.2.js"></script>
  <script type="text/javascript" src="jquery.ztree-2.6.js"></script>
  <script type="text/javascript" src="demoTools.js"></script>
  <SCRIPT LANGUAGE="JavaScript">
  <!--
	var zTree1;
	var setting;

	var zNodes =[
		{name:"100涓妭鐐�, id:"1", count:100, isParent:true},
		{name:"500涓妭鐐�, id:"2", count:500, isParent:true},
		{name:"1000涓妭鐐�, id:"3", count:1000, isParent:true}
	];

	setting = {
		expandSpeed: "",
		callback: {
			beforeExpand: zTreeBeforeExpand,
			beforeCollapse: zTreeBeforeCollapse,
			expand: zTreeOnExpand,
			collapse: zTreeOnCollapse
		}
	};

	$(document).ready(function(){
		reloadTree();
	});

//	var asyncUrl = "asyncData/nodeForHugeData.jsp";
	var asyncUrl = "asyncData/nodeForHugeData.php";
	var isGetNodes = false;
	var curParentNode = null;
	var startTime = 0;
	var endTime = 0;
	function zTreeBeforeExpand(treeId, treeNode) {
		if (!isGetNodes && treeNode.isParent && (!treeNode.nodes || treeNode.nodes.length==0)) {
			curParentNode = treeNode;
			isGetNodes = true;
			var id = curParentNode.id;
			var count = curParentNode.count;
			startTime = new Date();		
			ajaxGetNodes(id, 0, count)
			return false;
		} else if (isGetNodes && treeNode.isParent && (!treeNode.nodes || treeNode.nodes.length==0)) {
			alert("鏈夊叾浠栬妭鐐规鍦ㄤ笅杞芥暟鎹腑锛岃绋嶅悗灞曞紑鑺傜偣銆傘�銆�);
			return false;
		} else if (isGetNodes && treeNode == curParentNode ) {
			alert("璇ヨ妭鐐规鍦ㄤ笅杞芥暟鎹腑锛岃绋嶅悗灞曞紑鑺傜偣銆傘�銆�);
			return false;
		}
		return true;
	}

	function zTreeOnExpand(event, treeId, treeNode) {	
	}

	function zTreeBeforeCollapse(treeId, treeNode) {
	}

	function zTreeOnCollapse(event, treeId, treeNode) {	
	}

	function ajaxGetNodes(id, times, totalCount) {

		var curCount = (curParentNode.nodes) ? curParentNode.nodes.length : 0;
			
		var getCount = (curCount + perCount) > totalCount ? (totalCount - curCount) : perCount; 
		
		var tmpParam = "id="+id+"_"+times +"&count="+getCount;
		
		$.ajax({
			type: "POST",
			url: asyncUrl,
			data: tmpParam,
			success: function(msg) {
				if (!msg || msg.length == 0) {
					isGetNodes = false;
					return;
				}
				var newNodes = "";
				try {
					newNodes = eval("(" + msg + ")");
				} catch(err) {}

				if (newNodes && newNodes != "") {
					zTree1.addNodes(curParentNode, newNodes, true);

					var ajaxInfo = "treeNode:" + curParentNode.name;
					if (curParentNode.nodes.length < totalCount) {
						var percent = curParentNode.nodes.length*100/totalCount + "%";
						ajaxInfo += ("<br/>杩涘害锛� + percent);
						if (!curParentNode.tmpName) curParentNode.tmpName = curParentNode.name;
						curParentNode.name = curParentNode.tmpName + "(" + percent + ")";
						zTree1.updateNode(curParentNode);
						setTimeout("ajaxGetNodes('" + id+ "', "+(times+1)+", "+totalCount+")", perTime);
					} else {
						endTime = new Date();
						var usedTime = (endTime.getTime() - startTime.getTime())/1000;		
						ajaxInfo += ("<br/>鍔犺浇瀹屾瘯锛屽叡"+curParentNode.nodes.length+"涓瓙鑺傜偣, 鑰楁椂锛�+ usedTime + "绉�);
						curParentNode.name = curParentNode.tmpName;
						curParentNode.tmpName = null;
						zTree1.updateNode(curParentNode);
						//zTree1.expandNode(curParentNode, true, false);
						zTree1.selectNode(curParentNode.nodes[0]);
						isGetNodes = false;
					}

					$("#onAsync").html(ajaxInfo);
				}

			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				alert("寮傛鑾峰彇鏁版嵁鍑虹幇寮傚父銆�);
				isGetNodes = false;
			}
		});
	}

	var perCount = 10;
	function changeCount(count) {
		if (isGetNodes) {
			alert("zTree姝ｅ湪涓嬭浇鏁版嵁涓紝璇风◢鍚庢洿鏀归厤缃�銆傘�");
			$("#a_" + perCount).attr("checked", true);
			return;
		}
		perCount = count;
		reloadTree()
	}
	var perTime = 50;
	function changeTime(time) {
		if (isGetNodes) {
			alert("zTree姝ｅ湪涓嬭浇鏁版嵁涓紝璇风◢鍚庢洿鏀归厤缃�銆傘�");
			$("#at_" + perTime).attr("checked", true);
			return;
		}
		perTime = time;
		reloadTree()
	}
	
	function reloadTree() {
		zTree1 = $("#treeDemo").zTree(setting, clone(zNodes, ""));
		$("#onAsync").html("<br/>");
	}

  //-->
  </SCRIPT>
 </HEAD>

<BODY>
<center class="headTitle">澶ф暟鎹噺婕旂ず<span> 鈥斺� 楂樼骇寮傛鍔犺浇</span></center>
<TABLE border=0 width="700" class="tb1">
	<TR>
		<TD width=340px align=center valign=top>
		<div class="zTreeDemoBackground">
			<ul id="treeDemo" class="tree"></ul>
		</div>		
		</TD>
		<TD width=360px align=left valign=top>
		<div class="demoContent">
			<li class="title focus">
				<font color="red" style="font-size:12px;">姝ゆ紨绀洪渶瑕佸彂甯冨埌 php 鏈嶅姟鍣ㄤ笅鏂硅兘姝ｅ父鎵ц銆�br/>
				浣跨敤 Tomcat 鐨勬湅鍙嬶紝璇蜂慨鏀筧syncUrl鐨勫�</font>
			</li>
			<li class="title focus">
				<button class="ico star" onfocus="this.blur();"></button>寮傛鍔犺浇鏁版嵁閰嶇疆
				<ul class="remark">鈥斺�淇敼浠ヤ笅閰嶇疆鍚庯紝閲嶆柊灞曞紑鑺傜偣鐪嬬湅鍙樺寲</ul>
				<ul>
					鍗曟鑾峰彇鏉℃暟锛�INPUT TYPE="radio" id="a_10" NAME="aCount" checked onclick="changeCount(10);">10鏉�
					<INPUT TYPE="radio" id="a_50" NAME="aCount" onclick="changeCount(50);">50鏉�
					<INPUT TYPE="radio" id="a_100" NAME="aCount" onclick="changeCount(100);">100鏉�
					<br/>鍗曟鑾峰彇闂撮殧锛�INPUT TYPE="radio" id="at_50" NAME="aTime" checked onclick="changeTime(50);">50姣
					<INPUT TYPE="radio" id="at_100" NAME="aTime" onclick="changeTime(100);">100姣
					<INPUT TYPE="radio" id="at_300" NAME="aTime" onclick="changeTime(300);">300姣
				</ul>
			</li>
			<li class="title focus">
				<button class="ico books" onfocus="this.blur();"></button>寮傛鍔犺浇璇存槑
				<ul class="remark">
					姝ゅ簲鐢ㄥ畬鍏ㄥ埄鐢�zTree 鎻愪緵鐨勬帴鍙ｏ紝閽堝鐗规畩妗堜緥瀹炵幇鐨勫姛鑳姐�
				</ul>
				<ul class="remark">
					瀵逛簬涓婂崈涓妭鐐圭殑涓�鎬у姞杞斤紝鍦↖E涓嬫湁鍙兘浼氬嚭鐜颁竴娈垫椂闂寸殑鍋�br/>
					姝荤姸鎬侊紝涓轰簡閬垮厤杩欑鎯呭喌锛屽埗浣滆嚜瀹氫箟鐨勫紓姝ュ姞杞芥柟娉曪紝灏嗕笂鍗�br/>
					涓妭鐐硅繘琛屽垎缁勪笅杞斤紝鍗抽伩鍏嶄簡椤甸潰鐨勫亣姝伙紝涔熷彲浠ユ彁渚涘弸濂界殑杩�br/>
					搴︽彁绀哄姛鑳姐�
				</ul>
				<ul class="remark">
					搴旂敤涓繕瀹炵幇浜嗚嚜鍔ㄥ睍寮�妭鐐瑰苟閫変腑绗竴涓瓙鑺傜偣鐨勫姛鑳姐�
				</ul>
			</li>
			<li class="title focus">
				<button class="ico safari" onfocus="this.blur();"></button>浜嬩欢鐩戞帶
				<ul class="event">
				寮傛鍔犺浇:&nbsp;&nbsp;<a id="onAsync"><br/></a><br/>
				</ul>
				
			</li>
				
		</div>	
		</TD>
	</TR>
</TABLE>
</BODY>
</HTML>
