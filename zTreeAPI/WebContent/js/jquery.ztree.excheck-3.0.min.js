/*
 * JQuery zTree excheck 3.0
 * http://code.google.com/p/jquerytree/
 *
 * Copyright (c) 2010 Hunter.z (baby666.cn)
 *
 * Licensed same as jquery - MIT License
 * http://www.opensource.org/licenses/mit-license.php
 *
 * email: hunter.z@263.net
 * Date: 2011-12-20
 */
(function(m){var p,q,r,o={event:{CHECK:"ztree_check"},id:{CHECK:"_check"},checkbox:{STYLE:"checkbox",DEFAULT:"chk",DISABLED:"disable",FALSE:"false",TRUE:"true",FULL:"full",PART:"part",FOCUS:"focus"},radio:{STYLE:"radio",TYPE_ALL:"all",TYPE_LEVEL:"level"}},t={check:{enable:!1,autoCheckTrigger:!1,chkStyle:o.checkbox.STYLE,nocheckInherit:!1,radioType:o.radio.TYPE_LEVEL,chkboxType:{Y:"ps",N:"ps"}},data:{key:{checked:"checked"}},callback:{beforeCheck:null,onCheck:null}};p=function(c,a){if(a.chkDisabled===
!0)return!1;var b=h.getSetting(c.data.treeId),d=b.data.key.checked;if(n.apply(b.callback.beforeCheck,[b.treeId,a],!0)==!1)return!0;a[d]=!a[d];e.checkNodeRelation(b,a);d=m("#"+a.tId+i.id.CHECK);e.setChkClass(b,d,a);e.repairParentChkClassWithSelf(b,a);b.treeObj.trigger(i.event.CHECK,[b.treeId,a]);return!0};q=function(c,a){if(a.chkDisabled===!0)return!1;var b=h.getSetting(c.data.treeId),d=m("#"+a.tId+i.id.CHECK);a.check_Focus=!0;e.setChkClass(b,d,a);return!0};r=function(c,a){if(a.chkDisabled===!0)return!1;
var b=h.getSetting(c.data.treeId),d=m("#"+a.tId+i.id.CHECK);a.check_Focus=!1;e.setChkClass(b,d,a);return!0};m.extend(!0,m.fn.zTree.consts,o);m.extend(!0,m.fn.zTree._z,{tools:{},view:{checkNodeRelation:function(c,a){var b,d,f,j=c.data.key.children,k=c.data.key.checked;b=i.radio;if(c.check.chkStyle==b.STYLE){var g=h.getRadioCheckedList(c);if(a[k])if(c.check.radioType==b.TYPE_ALL){for(d=g.length-1;d>=0;d--)b=g[d],b[k]=!1,g.splice(d,1),e.setChkClass(c,m("#"+b.tId+i.id.CHECK),b),b.parentTId!=a.parentTId&&
e.repairParentChkClassWithSelf(c,b);g.push(a)}else{g=a.parentTId?a.getParentNode():h.getRoot(c);for(d=0,f=g[j].length;d<f;d++)b=g[j][d],b[k]&&b!=a&&(b[k]=!1,e.setChkClass(c,m("#"+b.tId+i.id.CHECK),b))}else if(c.check.radioType==b.TYPE_ALL)for(d=0,f=g.length;d<f;d++)if(a==g[d]){g.splice(d,1);break}}else a[k]&&(!a[j]||a[j].length==0||c.check.chkboxType.Y.indexOf("s")>-1)&&e.setSonNodeCheckBox(c,a,!0),!a[k]&&(!a[j]||a[j].length==0||c.check.chkboxType.N.indexOf("s")>-1)&&e.setSonNodeCheckBox(c,a,!1),
a[k]&&c.check.chkboxType.Y.indexOf("p")>-1&&e.setParentNodeCheckBox(c,a,!0),!a[k]&&c.check.chkboxType.N.indexOf("p")>-1&&e.setParentNodeCheckBox(c,a,!1)},makeChkClass:function(c,a){var b=c.data.key.checked,d=i.checkbox,f=i.radio,j="",j=a.chkDisabled===!0?d.DISABLED:c.check.chkStyle==f.STYLE?a.check_Child_State<1?d.FULL:d.PART:a[b]?a.check_Child_State===2||a.check_Child_State===-1?d.FULL:d.PART:a.check_Child_State<1?d.FULL:d.PART,b=c.check.chkStyle+"_"+(a[b]?d.TRUE:d.FALSE)+"_"+j,b=a.check_Focus&&
a.chkDisabled!==!0?b+"_"+d.FOCUS:b;return d.DEFAULT+" "+b},repairAllChk:function(c,a){if(c.check.enable&&c.check.chkStyle===i.checkbox.STYLE)for(var b=c.data.key.checked,d=c.data.key.children,f=h.getRoot(c),j=0,k=f[d].length;j<k;j++){var g=f[d][j];g.nocheck!==!0&&(g[b]=a);e.setSonNodeCheckBox(c,g,a)}},repairChkClass:function(c,a){if(a){h.makeChkFlag(c,a);var b=m("#"+a.tId+i.id.CHECK);e.setChkClass(c,b,a)}},repairParentChkClass:function(c,a){if(a&&a.parentTId){var b=a.getParentNode();e.repairChkClass(c,
b);e.repairParentChkClass(c,b)}},repairParentChkClassWithSelf:function(c,a){if(a){var b=c.data.key.children;a[b]&&a[b].length>0?e.repairParentChkClass(c,a[b][0]):e.repairParentChkClass(c,a)}},repairSonChkDisabled:function(c,a,b){if(a){var d=c.data.key.children;if(a.chkDisabled!=b)a.chkDisabled=b,a.nocheck!==!0&&e.repairChkClass(c,a);if(a[d])for(var f=0,j=a[d].length;f<j;f++)e.repairSonChkDisabled(c,a[d][f],b)}},repairParentChkDisabled:function(c,a,b){if(a){if(a.chkDisabled!=b)a.chkDisabled=b,a.nocheck!==
!0&&e.repairChkClass(c,a);e.repairParentChkDisabled(c,a.getParentNode(),b)}},setChkClass:function(c,a,b){a&&(b.nocheck===!0?a.hide():a.show(),a.removeClass(),a.addClass(e.makeChkClass(c,b)))},setParentNodeCheckBox:function(c,a,b,d){var f=c.data.key.children,j=c.data.key.checked,k=m("#"+a.tId+i.id.CHECK);d||(d=a);h.makeChkFlag(c,a);a.nocheck!==!0&&a.chkDisabled!==!0&&(a[j]=b,e.setChkClass(c,k,a),c.check.autoCheckTrigger&&a!=d&&a.nocheck!==!0&&c.treeObj.trigger(i.event.CHECK,[c.treeId,a]));if(a.parentTId){k=
!0;if(!b)for(var f=a.getParentNode()[f],g=0,l=f.length;g<l;g++)if(f[g].nocheck!==!0&&f[g][j]||f[g].nocheck===!0&&f[g].check_Child_State>0){k=!1;break}k&&e.setParentNodeCheckBox(c,a.getParentNode(),b,d)}},setSonNodeCheckBox:function(c,a,b,d){if(a){var f=c.data.key.children,j=c.data.key.checked,k=m("#"+a.tId+i.id.CHECK);d||(d=a);var g=!1;if(a[f])for(var l=0,n=a[f].length;l<n&&a.chkDisabled!==!0;l++){var o=a[f][l];e.setSonNodeCheckBox(c,o,b,d);o.chkDisabled===!0&&(g=!0)}if(a!=h.getRoot(c)&&a.chkDisabled!==
!0){g&&a.nocheck!==!0&&h.makeChkFlag(c,a);if(a.nocheck!==!0){if(a[j]=b,!g)a.check_Child_State=a[f]&&a[f].length>0?b?2:0:-1}else a.check_Child_State=-1;e.setChkClass(c,k,a);c.check.autoCheckTrigger&&a!=d&&a.nocheck!==!0&&c.treeObj.trigger(i.event.CHECK,[c.treeId,a])}}}},event:{},data:{getRadioCheckedList:function(c){for(var a=h.getRoot(c).radioCheckedList,b=0,d=a.length;b<d;b++)h.getNodeCache(c,a[b].tId)||(a.splice(b,1),b--,d--);return a},getCheckStatus:function(c,a){if(!c.check.enable||a.nocheck)return null;
var b=c.data.key.checked;return{checked:a[b],half:c.check.chkStyle==i.radio.STYLE?a.check_Child_State===2:a[b]?a.check_Child_State>-1&&a.check_Child_State<2:a.check_Child_State>0}},getTreeCheckedNodes:function(c,a,b,d){if(!a)return[];for(var f=c.data.key.children,j=c.data.key.checked,d=!d?[]:d,e=0,g=a.length;e<g;e++)a[e].nocheck!==!0&&a[e][j]==b&&d.push(a[e]),h.getTreeCheckedNodes(c,a[e][f],b,d);return d},getTreeChangeCheckedNodes:function(c,a,b){if(!a)return[];for(var d=c.data.key.children,f=c.data.key.checked,
b=!b?[]:b,j=0,e=a.length;j<e;j++)a[j].nocheck!==!0&&a[j][f]!=a[j].checkedOld&&b.push(a[j]),h.getTreeChangeCheckedNodes(c,a[j][d],b);return b},makeChkFlag:function(c,a){if(a){var b=c.data.key.children,d=c.data.key.checked,f=-1;if(a[b])for(var e=0,h=a[b].length;e<h;e++){var g=a[b][e],l=-1;if(c.check.chkStyle==i.radio.STYLE)if(l=g.nocheck===!0?g.check_Child_State:g.nocheck!==!0&&g[d]?2:g.check_Child_State>0?2:0,l==2){f=2;break}else l==0&&(f=0);else if(c.check.chkStyle==i.checkbox.STYLE)if(l=g.nocheck===
!0?g.check_Child_State:g.nocheck!==!0&&g[d]?g.check_Child_State===-1||g.check_Child_State===2?2:1:g.check_Child_State>0?1:0,l===1){f=1;break}else if(l===2&&e>0&&l!==f){f=1;break}else if(f===2&&l>-1&&l<2){f=1;break}else l>-1&&(f=l)}a.check_Child_State=f}}}});var o=m.fn.zTree,n=o._z.tools,i=o.consts,e=o._z.view,h=o._z.data;h.exSetting(t);h.addInitBind(function(c){var a=c.treeObj,b=i.event;a.unbind(b.CHECK);a.bind(b.CHECK,function(a,b,e){n.apply(c.callback.onCheck,[a,b,e])})});h.addInitCache(function(){});
h.addInitNode(function(c,a,b,d,f,e){if(b)a=c.data.key.checked,typeof b[a]=="string"&&(b[a]=n.eqs(b[a],"true")),b[a]=!!b[a],b.checkedOld=b[a],b.nocheck=!!b.nocheck||c.check.nocheckInherit&&d&&!!d.nocheck,b.chkDisabled=!!b.chkDisabled||d&&!!d.chkDisabled,b.check_Child_State=-1,b.check_Focus=!1,b.getCheckStatus=function(){return h.getCheckStatus(c,b)},e&&h.makeChkFlag(c,d)});h.addInitProxy(function(c){var a=c.target,b=h.getSetting(c.data.treeId),d="",f=null,e="",k=null;if(n.eqs(c.type,"mouseover")){if(b.check.enable&&
n.eqs(a.tagName,"button")&&a.getAttribute("treeNode"+i.id.CHECK)!==null)d=a.parentNode.id,e="mouseoverCheck"}else if(n.eqs(c.type,"mouseout")){if(b.check.enable&&n.eqs(a.tagName,"button")&&a.getAttribute("treeNode"+i.id.CHECK)!==null)d=a.parentNode.id,e="mouseoutCheck"}else if(n.eqs(c.type,"click")&&b.check.enable&&n.eqs(a.tagName,"button")&&a.getAttribute("treeNode"+i.id.CHECK)!==null)d=a.parentNode.id,e="checkNode";if(d.length>0)switch(f=h.getNodeCache(b,d),e){case "checkNode":k=p;break;case "mouseoverCheck":k=
q;break;case "mouseoutCheck":k=r}return{stop:!1,node:f,nodeEventType:e,nodeEventCallback:k,treeEventType:"",treeEventCallback:null}});h.addInitRoot(function(c){h.getRoot(c).radioCheckedList=[]});h.addBeforeA(function(c,a,b){var d=c.data.key.checked;c.check.enable&&(h.makeChkFlag(c,a),c.check.chkStyle==i.radio.STYLE&&c.check.radioType==i.radio.TYPE_ALL&&a[d]&&h.getRoot(c).radioCheckedList.push(a),b.push("<button type='button' ID='",a.tId,i.id.CHECK,"' class='",e.makeChkClass(c,a),"' treeNode",i.id.CHECK,
" onfocus='this.blur();' ",a.nocheck===!0?"style='display:none;'":"","></button>"))});h.addZTreeTools(function(c,a){a.checkNode=function(a,b,h,k){var g=this.setting.data.key.checked;if(a.chkDisabled!==!0&&(b!==!0&&b!==!1&&(b=!a[g]),k=!!k,(a[g]!==b||h)&&!(k&&n.apply(this.setting.callback.beforeCheck,[this.setting.treeId,a],!0)==!1)&&n.uCanDo(this.setting)&&this.setting.check.enable&&a.nocheck!==!0))a[g]=b,b=m("#"+a.tId+i.id.CHECK),(h||this.setting.check.chkStyle===i.radio.STYLE)&&e.checkNodeRelation(this.setting,
a),e.setChkClass(this.setting,b,a),e.repairParentChkClassWithSelf(this.setting,a),k&&c.treeObj.trigger(i.event.CHECK,[c.treeId,a])};a.checkAllNodes=function(a){e.repairAllChk(this.setting,!!a)};a.getCheckedNodes=function(a){var b=this.setting.data.key.children;return h.getTreeCheckedNodes(this.setting,h.getRoot(c)[b],a!==!1)};a.getChangeCheckedNodes=function(){var a=this.setting.data.key.children;return h.getTreeChangeCheckedNodes(this.setting,h.getRoot(c)[a])};a.setChkDisabled=function(a,b){b=!!b;
e.repairSonChkDisabled(this.setting,a,b);b||e.repairParentChkDisabled(this.setting,a,b)};var b=a.updateNode;a.updateNode=function(c,f){b&&b.apply(a,arguments);if(c&&this.setting.check.enable&&m("#"+c.tId).get(0)&&n.uCanDo(this.setting)){var h=m("#"+c.tId+i.id.CHECK);(f==!0||this.setting.check.chkStyle===i.radio.STYLE)&&e.checkNodeRelation(this.setting,c);e.setChkClass(this.setting,h,c);e.repairParentChkClassWithSelf(this.setting,c)}}});var s=e.createNodes;e.createNodes=function(c,a,b,d){s&&s.apply(e,
arguments);b&&e.repairParentChkClassWithSelf(c,d)}})(jQuery);
