<!DOCTYPE html>
<HTML>
	<HEAD>
		<TITLE>Recursive & Iteration Test</TITLE>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<link rel="stylesheet" href="../../demo/demoStyle/demo.css" type="text/css">
		<style type="text/css" >
			div.content {
				margin: 20px 0 0 0;
				border: grey solid 1px;
				overflow:scroll;
				width: 800px;
				height: 400px;
			}
			span#resultContent {
				color: #fb7878;
			}
			li {
				white-space: nowrap;
			}
			input {
				margin-right: 10px;
			}
			span.remark {
				color:red;
			}
			table {
				width: 900px;
				border-collapse:collapse;
				border-spacing:0;
				border-left:1px solid #888;
				border-top:1px solid #888;
				background:#efefef;
				margin: 5px 0;
			}
			th,td{
				border-right:1px solid #888;
				border-bottom:1px solid #888;
				padding:5px 15px;
			}
			td {
				height: 20px;
			}
			th{
				font-weight:bold;
				background:#ccc;
			}
		</style>
		<script type="text/javascript" src="../../demo/jquery-1.4.2.js"></script>
		<SCRIPT type="text/javascript">
			<!--

			var totalTime = 0;
			function testOperator() {
				document.getElementById("testBtn").disabled = true;
				totalTime = 0;
				var curTimes = 1;
				var testTimes = document.getElementById("testTimes").value;
				testTimes = isNaN(testTimes) ? 10 : parseInt(testTimes);
				var levelCount = document.getElementById("levelCount").value;
				levelCount = isNaN(levelCount) ? 10 : parseInt(levelCount);

				var testName = "";
				var radios = document.getElementsByName("testRadio");
				for (var r = 0; r < radios.length; r++) {
					if (radios[r].checked) {
						testName = radios[r].id;
						break;
					}
				}
				if (testName.length==0) {
					document.getElementById("testBtn").disabled = false;
					return;
				}
				
				var resultContent = document.getElementById(testName + "_result");
				var resultLog = document.getElementById(testName + "_log");
				setTimeout(function(){threadTest(curTimes, testName, levelCount, testTimes, resultContent, resultLog);}, 10);
			}

			function threadTest(curTimes, testName, levelCount, testTimes, resultContent, resultLog) {
				var test;
				if (testName === "testR") {
					test = testFun.recursiveMain;
				} else {
					test = testFun.iterationMain;
				}
				if (curTimes == 1) {
					resultContent.innerHTML = "testing...";
					resultLog.innerHTML = "";
				}
				var time = test(levelCount);
				totalTime += time;
				resultLog.appendChild(document.createTextNode("(" + curTimes + ")  " + time));
				resultLog.appendChild(document.createElement("br"));
				
				if (curTimes >= testTimes) {
					resultContent.innerHTML = (totalTime/curTimes).toFixed(1) + "";
					document.getElementById("testBtn").disabled = false;
				} else {
					setTimeout(function(){threadTest(curTimes+1, testName, levelCount, testTimes, resultContent, resultLog);}, 10);
				}
			}

			testFun = {
				/* simple_append_single */
				recursiveMain : function(count) {
					var timeStart = new Date();
					console.log(testFun.recursive(count).length);
					var timeEnd = new Date();
					return (timeEnd.getTime() - timeStart.getTime());
				},
				recursive : function(count) {
					var str = [];
					for (var i=0; i<20; i++) {
						str.push(count, "-", i, ";");
					}
					if (count > 0) {
						str.push((arguments.callee(count-1)));
					}
					return str.join('');
				},
				iterationMain : function(count) {
					var timeStart = new Date();
//					console.log(testFun.iteration(count).length);
					var timeEnd = new Date();
					return (timeEnd.getTime() - timeStart.getTime());
				},
				recursiveForIteration : function(count) {
					var str = [];
					for (var i=0; i<20; i++) {
						str.push(count, "-", i, ";");
					}
					if (count > 0) {
						str.push((arguments.callee(count-1)));
					}
					return str.join('');
				},
				iteration : function(count) {
					var str = [];
					for (var j=count; j>=0; j--) {
						for (var i=0; i<20; i++) {
							str.push(j, "-", i, ";");
						}
					}
					return str.join('');
				}
    
			}
			//-->
		</SCRIPT>
	</HEAD>

	<BODY>
		<h1>Recursive & Iteration Test</h1>
        <span>Level Count:</span><input type="text" id="levelCount" value="10000" size="10" />
        <span>Test Times:</span><input type="text" id="testTimes" value="10" size="3" />
        <input type="button" id="testBtn" onclick="testOperator();"  value="start" />
        <table>
            <tbody>
                <tr><th ><input type="radio" name="testRadio" id="testR" />Recursive 递归</th>
					<th ><input type="radio" name="testRadio" id="testI" />Iteration 迭代</th>
				</tr>
                <tr>
                    <td id="testR_result"></td><td id="testI_result"></td>
				</tr>
                <tr>
                    <td id="testR_log"></td><td id="testI_log"></td>
				</tr>
            </tbody>
        </table>

	</BODY>
</HTML>
