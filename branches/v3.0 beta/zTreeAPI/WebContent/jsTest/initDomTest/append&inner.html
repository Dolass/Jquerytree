<!DOCTYPE html>
<html>
    <head>
    <title>AppendChild & innerHTML Test</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<link rel="stylesheet" href="../../demo/demoStyle/demo.css" type="text/css">
		<link rel="stylesheet" href="../../demo/zTreeStyle/zTreeStyle.css" type="text/css">
    <style type="text/css">
div.content {
    margin: 20px 0 0 0;
    border: grey solid 1px;
    overflow:scroll;
    width: 800px;
    height: 400px;
}
span#resultContent {
    color: #fb7878;
}
li {
    white-space: nowrap;
}
input {
    margin-right: 10px;
}
span.remark {
    color:red;
}
table {
    width: 80%;
    border-collapse:collapse;
    border-spacing:0;
    border-left:1px solid #888;
    border-top:1px solid #888;
    background:#efefef;
    margin: 5px 0;
}
th,td{
    border-right:1px solid #888;
    border-bottom:1px solid #888;
    padding:5px 15px;
}
td {
    height: 20px;
}
th{
    font-weight:bold;
    background:#ccc;
}
    </style>
	<script type="text/javascript" src="../jQuery/jquery-1.4.2.js"></script>
    <script type="text/javascript">
function testOperator() {
    document.getElementById("testBtn").disabled = true;
    var totalTime = 0;
    var curTimes = 0;
    var testTimes = document.getElementById("testTimes").value;
    testTimes = isNaN(testTimes) ? 10 : parseInt(testTimes);
    var domCount = document.getElementById("domCount").value;
    domCount = isNaN(domCount) ? 500 : parseInt(domCount);
    
    var testName = "";
    var radios = document.getElementsByName("testRadio");
    for (var r = 0; r < radios.length; r++) {
        if (radios[r].checked) {
            testName = radios[r].id;
            break;
        }
    }
    if (testName.length==0) {
        document.getElementById("testBtn").disabled = false;
        return;
    }
    
    var resultContent = document.getElementById(testName + "_result");
    var resultLog = document.getElementById(testName + "_log");
    resultContent.innerHTML = "testing...";
    resultLog.innerHTML = "";
    
    testFun.clearDoms();
    while (curTimes < testTimes) {
        curTimes++;
        var time = testFun[testName](domCount);
        totalTime += time;
        resultLog.appendChild(document.createTextNode("(" + curTimes + ")  " + time));
        resultLog.appendChild(document.createElement("br"));
        if (curTimes < testTimes) {testFun.clearDoms();}
    }
    resultContent.innerHTML = (totalTime/curTimes).toFixed(1) + "";
    document.getElementById("testBtn").disabled = false;
    
}

testFun = {
    /* simple_append_single */
    r1 : function(count) {
        var timeStart = new Date();
        var treeDemo = document.getElementById("treeDemo");
        var newRootLi = document.createElement("li");
        newRootLi.appendChild(document.createElement("ul"));
        treeDemo.appendChild(newRootLi);
        (function(){
            for (var i = 0; i<count; i++) {
                var newLi = document.createElement("li");
                newLi.appendChild(document.createElement("ul"));
                newLi.firstChild.appendChild(document.createElement("li"));
                newLi.firstChild.firstChild.appendChild(document.createTextNode(" == ul " + i + " == "));
                newRootLi.firstChild.appendChild(newLi);
            }
        })()
        var timeEnd = new Date();
        return (timeEnd.getTime() - timeStart.getTime());
    },
    /* simple_append_all */
    o1 : function(count) {
        var timeStart = new Date();
        var treeDemo = document.getElementById("treeDemo");
        var newRootLi = document.createElement("li");
        newRootLi.appendChild(document.createElement("ul"));
        (function(){
            for (var i = 0; i<count; i++) {
                var newLi = document.createElement("li");
                newLi.appendChild(document.createElement("ul"));
                newLi.firstChild.appendChild(document.createElement("li"));
                newLi.firstChild.firstChild.appendChild(document.createTextNode(" == ul " + i + " == "));
                newRootLi.firstChild.appendChild(newLi);
            }
        })();
        treeDemo.appendChild(newRootLi);
        var timeEnd = new Date();
        return (timeEnd.getTime() - timeStart.getTime());
    },
 
     /* simple_inner_single */
    r2 : function(count) {
        var timeStart = new Date();
        var tmpUL = document.createElement("ul");
        var treeDemo = document.getElementById("treeDemo");
        var newRootLi = document.createElement("li");
        newRootLi.appendChild(document.createElement("ul"));
        treeDemo.appendChild(newRootLi);
        (function(){
            for (var i = 0; i<count; i++) {
                tmpUL.innerHTML = "<li><ul><li> == ul " + i + " == </li></ul></li>";
                newRootLi.firstChild.appendChild(tmpUL.firstChild);
            }
        })();
        var timeEnd = new Date();
        return (timeEnd.getTime() - timeStart.getTime());
    },

     /* simple_inner_all */
    o2 : function(count) {
        var timeStart = new Date();
        var treeDemo = document.getElementById("treeDemo");
        var newRootLi = document.createElement("li");
        newRootLi.appendChild(document.createElement("ul"));
        treeDemo.appendChild(newRootLi);
        var htmlstr = [];
        (function(){
            for (var i = 0; i<count; i++) {
//                htmlstr.push("<li id='treeDemo_1' treenode><button type='button' id='treeDemo_1_switch' title='' class='switch_roots_docu' treeNode_switch onfocus='this.blur();'></button><a id='treeDemo_1_a' treeNode_a onclick=\"\"  target='_blank' style=''title='z1'><button type='button' id='treeDemo_1_ico' title='' treeNode_ico onfocus='this.blur();' class=' ico_docu' style=''></button><span id='treeDemo_1_span'>z1</span></a><ul id='treeDemo_1_ul' class='line' style='display:none'></ul></li>");
                htmlstr.push("<li id='treeDemo_1' treenode><button type='button' id='treeDemo_1_switch' title='' class='switch_roots_docu' style='' treeNode_switch ></button><a id='treeDemo_1_a' treeNode_a onclick=\"\"  target='_blank' style=''title='z1'><button type='button' id='treeDemo_1_ico' title='' treeNode_ico class=' ico_docu' style=''></button><span id='treeDemo_1_span'>z1</span></a></li>");
//				htmlstr.push("<li id='treeDemo_1' treenode><button type='button' id='treeDemo_1_switch' title='' class='chk checkbox_false_full' style='' treeNode_switch ></button><a id='treeDemo_1_a' treeNode_a onclick=\"\"  target='_blank' style=''title='z1'><button type='button' id='treeDemo_1_ico' title='' treeNode_ico class='chk checkbox_true_full' style=''></button><span id='treeDemo_1_span'>z1</span></a></li>");
            }
        })();
//		var tmpClass = treeDemo.className;
//		treeDemo.className = "";
//		treeDemo.style.visibility = "hidden";
//        newRootLi.firstChild.innerHTML = htmlstr.join("");
//		treeDemo.className = tmpClass;
//		treeDemo.style.visibility = "visible";
        $(newRootLi.firstChild).append(htmlstr.join(""));
        var timeEnd = new Date();
        return (timeEnd.getTime() - timeStart.getTime());
    },
    
     /* tree_append_single */
    r3 : function(count) {
        var timeStart = new Date();
        var treeDemo = document.getElementById("treeDemo");
        var newRootLi = document.createElement("li");
        newRootLi.appendChild(document.createElement("ul"));
        treeDemo.appendChild(newRootLi);
        var lastContent = newRootLi.firstChild;
        (function(){
            for (var i = 0; i<count; i++) {
                var newLi = document.createElement("li");
                newLi.appendChild(document.createElement("ul"));
                newLi.firstChild.appendChild(document.createElement("li"));
                newLi.firstChild.firstChild.appendChild(document.createTextNode(" == ul " + i + " == "));
                lastContent.appendChild(newLi);
                lastContent = lastContent.lastChild.firstChild;
            }
        })();
        var timeEnd = new Date();
        return (timeEnd.getTime() - timeStart.getTime());
    },

     /* tree_append_all */
    o3 : function(count) {
        var timeStart = new Date();
        var treeDemo = document.getElementById("treeDemo");
        var newRootLi = document.createElement("li");
        newRootLi.appendChild(document.createElement("ul"));
        var lastContent = newRootLi.firstChild;
        (function(){
            for (var i = 0; i<count; i++) {
                var newLi = document.createElement("li");
                newLi.appendChild(document.createElement("ul"));
                newLi.firstChild.appendChild(document.createElement("li"));
                newLi.firstChild.firstChild.appendChild(document.createTextNode(" == ul " + i + " == "));
                lastContent.appendChild(newLi);
                lastContent = lastContent.lastChild.firstChild;
            }
        })();
        treeDemo.appendChild(newRootLi);
        var timeEnd = new Date();
        return (timeEnd.getTime() - timeStart.getTime());
    },

     /* tree_inner_single */
    r4 : function(count) {
        var timeStart = new Date();
        var tmpUL = document.createElement("ul");
        var treeDemo = document.getElementById("treeDemo");
        var newRootLi = document.createElement("li");
        newRootLi.appendChild(document.createElement("ul"));
        treeDemo.appendChild(newRootLi);
        var lastContent = newRootLi.firstChild;
        (function(){
            for (var i = 0; i<count; i++) {
                tmpUL.innerHTML = "<li><ul><li> == ul " + i + " == </li></ul></li>";
                lastContent.appendChild(tmpUL.firstChild);
                lastContent = lastContent.lastChild.firstChild;
            }
        })();
        var timeEnd = new Date();
        return (timeEnd.getTime() - timeStart.getTime());
    },

     /* tree_inner_all */
    o4 : function(count) {
        var timeStart = new Date();
        var treeDemo = document.getElementById("treeDemo");
        var htmlArray = ["<li><ul>"];
        (function(curCount){
			htmlArray.push("<li><ul><li> == ul " + curCount + " == </li>");
            if (curCount < (count - 1) ) {
                arguments.callee(curCount+1);
            }
            htmlArray.push("</ul></li>");
        })(0);
        htmlArray.push("</ul></li>");
        treeDemo.innerHTML = htmlArray.join("");
        var timeEnd = new Date();
        return (timeEnd.getTime() - timeStart.getTime());
    },
    
    clearDoms : function () {
        var treeDemo = document.getElementById("treeDemo");
        treeDemo.innerHTML = "";
    }
}



    </script>
    </head>
    <body>
        <h1>Add Dom Test --- AppendChild & innerHTML</h1>
        <span>Add Dom Counts:</span><input type="text" id="domCount" value="1000" size="6"/>
        <span>Test Times:</span><input type="text" id="testTimes" value="1" size="3" />
        <input type="button" id="testBtn" onclick="testOperator();"  value="start" />
        <br/><span class="remark">进行 Tree Dom 测试时，使用FireFox 3/4，当count大于500会经常导致崩溃</span>
        <table>
            <tbody>
                <tr><th colspan="4">Simple Dom</th><th colspan="4">Tree Dom</th></tr>
                <tr><th colspan="2">appendChild</th><th colspan="2">innerHTML</th><th colspan="2">appendChild</th><th colspan="2">innerHTML</th></tr>
                <tr>
                    <th><input type="radio" name="testRadio" id="r1" />single</th><th><input type="radio" name="testRadio" id="o1" />all</th>
                    <th><input type="radio" name="testRadio" id="r2" />single</th><th><input type="radio" name="testRadio" id="o2" />all</th>
                    <th><input type="radio" name="testRadio" id="r3" />single</th><th><input type="radio" name="testRadio" id="o3" />all</th>
                    <th><input type="radio" name="testRadio" id="r4" />single</th><th><input type="radio" name="testRadio" id="o4" />all</th>
               </tr>
                <tr>
                    <td id="r1_result"></td><td id="o1_result"></td>
                    <td id="r2_result"></td><td id="o2_result"></td>
                    <td id="r3_result"></td><td id="o3_result"></td>
                    <td id="r4_result"></td><td id="o4_result"></td>
               </tr>
                <tr>
                    <td id="r1_log"></td><td id="o1_log"></td>
                    <td id="r2_log"></td><td id="o2_log"></td>
                    <td id="r3_log"></td><td id="o3_log"></td>
                    <td id="r4_log"></td><td id="o4_log"></td>
               </tr>
            </tbody>
        </table>        
        <div class="zTreeDemoBackground">
            <ul id="treeDemo" class="tree"></ul>
        </div>
    </body>
</html>
